{"version":3,"sources":["Engine.js"],"names":[],"mappings":"AAAA,a;AACA,+B;;AAEM,M;AACJ,c,GAAa,IAAI,gBAAI,SAAJ,CAAc,MAAlB,E;AACb,S,GAAQ,C;;AAEJ,S,EAAyB,KAAlB,WAAkB,yDAAN,IAAM;AAC3B,WAAK,UAAL,CAAgB,GAAhB,CAAoB,KAApB,EAA2B,WAA3B,EACD,C;;;AAEM,S,EAAO;AACZ,WAAK,UAAL,CAAgB,MAAhB,CAAuB,KAAvB,EACD,C;;;AAEM;AACL,WAAK,KAAL,GACD,C;;;AAEQ;AACP,UAAI,CAAC,KAAK,KAAV,EAAiB,CAAE,MAAM,IAAI,KAAJ,CAAU,+BAAV,CAAN,CAAmD;AACtE,WAAK,KAAL;;AAEA,aAAO,CAAC,KAAK,KAAb,EAAoB;AAClB,YAAM,QAAQ,KAAK,UAAL,CAAgB,IAAhB,EAAd;AACA,YAAI,CAAC,KAAL,EAAY,CAAE,OAAO,KAAK,IAAL,EAAP,CAAqB,C;AACnC,YAAM,SAAS,MAAM,GAAN,EAAf;AACA,YAAI,UAAU,OAAO,IAArB,EAA2B,C;AACzB,eAAK,IAAL;AACA,iBAAO,IAAP,CAAY,KAAK,MAAL,CAAY,IAAZ,CAAiB,IAAjB,CAAZ,EACD,CACF,CACF,C;;;;;;AAGY,M","file":"Engine.js","sourcesContent":["'use strict';\r\nimport ROT from 'rot-js';\r\n\r\nclass Engine {\r\n  _scheduler = new ROT.Scheduler.Action();\r\n  _lock = 1;\r\n\r\n  add(actor, isRecurring=true) {\r\n    this._scheduler.add(actor, isRecurring);\r\n  }\r\n  \r\n  remove(actor) {\r\n    this._scheduler.remove(actor);\r\n  }\r\n\r\n  lock() {\r\n    this._lock++;\r\n  }\r\n\r\n  unlock() {\r\n    if (!this._lock) { throw new Error(\"Cannot unlock unlocked engine\"); }\r\n    this._lock--;\r\n\r\n    while (!this._lock) {\r\n      const actor = this._scheduler.next();\r\n      if (!actor) { return this.lock(); } /* no actors */\r\n      const result = actor.act();\r\n      if (result && result.then) { /* actor returned a \"thenable\", looks like a Promise */\r\n        this.lock();\r\n        result.then(this.unlock.bind(this));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default Engine;\r\n"],"sourceRoot":"/source/"}